<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckIn30 - Daily Engagement Tracker</title>
    <meta name="description" content="Complete daily check-ins for 30 days and earn rewards">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ===== LOADER ===== */
        #app-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        
        .loader-logo {
            font-size: 3rem;
            margin-bottom: 20px;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== APP CONTAINER ===== */
        #app-container {
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* ===== BANNER ADS STYLES ===== */
        .banner-ad {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin: 15px auto;
            overflow: hidden;
            position: relative;
            max-width: 900px;
            border: 2px solid;
            display: none;
        }

        .banner-content {
            position: relative;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }

        .ad-placeholder {
            padding: 15px;
            text-align: center;
            color: var(--gray);
            font-size: 14px;
            width: 100%;
        }

        .close-ad {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--danger);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: var(--transition);
        }

        .close-ad:hover {
            background: #c82333;
            transform: scale(1.1);
        }

        .banner-type-1 { border-color: #ff6b6b; background: linear-gradient(135deg, #ff6b6b, #ff8e8e); }
        .banner-type-2 { border-color: #4ecdc4; background: linear-gradient(135deg, #4ecdc4, #88d3ce); }
        .banner-type-3 { border-color: #ffd166; background: linear-gradient(135deg, #ffd166, #ffdf8c); }
        
        .native-ad-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .native-ad-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .native-ad-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            flex-direction: column;
        }
        
        .native-ad-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            color: var(--danger);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            box-shadow: var(--shadow);
            z-index: 10000;
        }

        /* ===== VISIT NOTICE ===== */
        .visit-notice {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }
        
        .visit-notice-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .visit-notice-icon {
            font-size: 3rem;
            color: var(--warning);
            margin-bottom: 15px;
        }
        
        .visit-timer {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        /* ===== NAVIGATION ===== */
        .navbar {
            background: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .nav-link:hover {
            background: var(--primary);
            color: white;
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        .nav-link i {
            font-size: 1.1rem;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--dark);
            cursor: pointer;
        }

        /* ===== AUTH PAGES ===== */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .auth-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .auth-header p {
            color: var(--gray);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-block {
            width: 100%;
        }

        .btn-google {
            background: white;
            color: var(--dark);
            border: 2px solid var(--gray-light);
        }

        .btn-google:hover {
            background: #f8fafc;
            border-color: var(--primary);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 30px 0;
            color: var(--gray);
        }

        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: var(--gray-light);
        }

        .divider span {
            padding: 0 15px;
            font-size: 0.9rem;
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* ===== DASHBOARD ===== */
        .dashboard-container {
            padding: 30px 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .stat-card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .stat-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .progress-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-bar-container {
            background: var(--gray-light);
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .reward-status {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .status-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        /* ===== ACTIVITY PAGE ===== */
        .activity-container {
            padding: 30px 20px;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .timer-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px 30px;
            box-shadow: var(--shadow-lg);
            margin: 30px 0;
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
            margin: 30px 0;
            font-family: 'Courier New', monospace;
        }

        .timer-complete {
            color: var(--secondary);
        }

        .timer-progress {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
        }

        .timer-circle {
            width: 100%;
            height: 100%;
        }

        .timer-circle-bg {
            fill: none;
            stroke: var(--gray-light);
            stroke-width: 10;
        }

        .timer-circle-progress {
            fill: none;
            stroke: var(--primary);
            stroke-width: 10;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s linear;
        }

        .timer-instructions {
            background: #f0f9ff;
            border-left: 4px solid var(--primary);
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            text-align: left;
        }

        .timer-instructions ul {
            padding-left: 20px;
        }

        .timer-instructions li {
            margin-bottom: 10px;
        }

        /* ===== MODAL POPUP ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header i {
            font-size: 4rem;
            color: var(--warning);
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .modal-body {
            margin-bottom: 30px;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
        }

        .modal-footer .btn {
            flex: 1;
        }

        /* ===== REWARD FORM ===== */
        .reward-form {
            max-width: 500px;
            margin: 0 auto;
        }

        .reward-info {
            background: #f0f9ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .reward-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .disclaimer {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9rem;
            color: #92400e;
        }

        /* ===== FOOTER ===== */
        .footer {
            background: var(--dark);
            color: white;
            padding: 40px 20px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .footer-section p {
            color: #cbd5e1;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .footer-links {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .footer-links a {
            color: #cbd5e1;
            text-decoration: none;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
            text-decoration: underline;
        }

        .footer-bottom {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #374151;
            color: #9ca3af;
            font-size: 0.85rem;
        }

        /* ===== LOADING STATES ===== */
        .page-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            gap: 20px;
        }

        .page-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ===== CONNECT SECTION ===== */
        .connect-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin: 30px auto;
            max-width: 600px;
            text-align: center;
        }
        
        .connect-form {
            margin-top: 20px;
        }
        
        .connect-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .connect-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .connect-btn:hover {
            background: #f8fafc;
            transform: translateY(-2px);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 70px;
                left: 0;
                right: 0;
                background: white;
                flex-direction: column;
                padding: 20px;
                box-shadow: var(--shadow);
                gap: 15px;
            }

            .nav-links.active {
                display: flex;
            }

            .mobile-menu-btn {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-footer {
                flex-direction: column;
            }

            .timer-display {
                font-size: 3rem;
            }

            .timer-progress {
                width: 150px;
                height: 150px;
            }
            
            .banner-ad {
                max-width: 95%;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-30 {
            margin-top: 30px;
        }

        .mb-30 {
            margin-bottom: 30px;
        }

        .hidden {
            display: none !important;
        }
        
        .show {
            display: block !important;
        }
        
        .flex {
            display: flex !important;
        }
    </style>
</head>
<body>
    <!-- Initial Loading Screen - Only shows for 2 seconds -->
    <div id="app-loader">
        <div class="loader-logo">
            <i class="fas fa-calendar-check"></i>
        </div>
        <div class="loader-spinner"></div>
        <h2>CheckIn30</h2>
        <p>Loading application...</p>
    </div>

    <!-- Visit Notice Modal -->
    <div id="visitNotice" class="visit-notice hidden">
        <div class="visit-notice-content">
            <div class="visit-notice-icon">
                <i class="fas fa-clock"></i>
            </div>
            <h2>ðŸ“¢ Important Notice</h2>
            <p class="mt-20">Please spend <strong>2 minutes</strong> visiting the website before starting the timer.</p>
            <p>This ensures genuine engagement with our platform.</p>
            
            <div class="visit-timer" id="visitTimer">02:00</div>
            
            <p>Timer will start automatically after 2 minutes of website visit.</p>
            <button onclick="startVisitTimer()" class="btn btn-primary mt-20">
                <i class="fas fa-play"></i> Start 2-Minute Visit
            </button>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="hidden">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="container">
                <div class="nav-container">
                    <a href="#" onclick="showPage('dashboard'); return false;" class="logo">
                        <i class="fas fa-calendar-check"></i>
                        <span>CheckIn30</span>
                    </a>
                    
                    <div class="nav-links" id="navLinks">
                        <a href="#" onclick="showPage('dashboard'); return false;" class="nav-link user-link hidden">
                            <i class="fas fa-home"></i> Dashboard
                        </a>
                        <a href="#" onclick="showPage('activity'); return false;" class="nav-link user-link hidden">
                            <i class="fas fa-running"></i> Daily Activity
                        </a>
                        <a href="#" onclick="showPage('reward'); return false;" class="nav-link user-link hidden">
                            <i class="fas fa-gift"></i> Rewards
                        </a>
                        <a href="#" onclick="logout(); return false;" class="nav-link user-link hidden">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                        <a href="#" onclick="showPage('login'); return false;" class="nav-link auth-link">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </div>
                    
                    <button class="mobile-menu-btn" onclick="toggleMenu()">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Banner Container -->
        <div id="banner-container"></div>

        <!-- Main Content -->
        <main id="main-content">
            <div class="container">
                <div id="page-container">
                    <!-- Pages will be loaded here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>CheckIn30</h3>
                        <p>Daily engagement tracking platform</p>
                        <p>Earn rewards by completing daily activities</p>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Quick Links</h3>
                        <div class="footer-links">
                            <a href="#" onclick="showPage('dashboard'); return false;">Dashboard</a>
                            <a href="#" onclick="showPage('activity'); return false;">Daily Activity</a>
                            <a href="#" onclick="showPage('reward'); return false;">Rewards</a>
                        </div>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Legal</h3>
                        <div class="footer-links">
                            <a href="#" onclick="showPage('terms'); return false;">Terms of Service</a>
                            <a href="#" onclick="showPage('privacy'); return false;">Privacy Policy</a>
                            <a href="#" onclick="showPage('disclaimer'); return false;">Disclaimer</a>
                        </div>
                    </div>
                    
                    <div class="footer-section">
                        <h3>Contact</h3>
                        <p>For support or queries:</p>
                        <p>Email: support@checkin30.com</p>
                    </div>
                </div>
                
                <div class="footer-bottom">
                    <div class="footer-disclaimer">
                        <p><strong>CheckIn30 is an engagement tracking platform.</strong></p>
                        <p>Rewards are discretionary and not guaranteed income.</p>
                    </div>
                    <p class="mt-20">Â© 2024 CheckIn30. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const CONFIG = {
            DAILY_POINTS: 10,
            REQUIRED_DAYS: 30,
            TIMER_DURATION: 120,
            VISIT_DURATION: 120,
            REWARD_POPUP_DELAY: 3600000,
            TELEGRAM_BOT_TOKEN: '8367971417:AAGkV30ajQdWKjM-5AQDxYZH19OPHI51HGM',
            TELEGRAM_CHAT_ID: '6225430212',
            ADMIN_EMAIL: 'admin@checkin30.com',
            
            BANNER_INTERVALS: {
                dashboard: [5, 15, 30],
                activity: [10, 25, 40],
                login: [10],
                reward: [5, 20]
            },
            
            BANNERS: {
                top: [
                    { id: 'banner-top-1', type: 'banner-type-1', text: 'Top Banner', adId: 'ADSTERRA_TOP_1' }
                ],
                mid: [
                    { id: 'banner-mid-1', type: 'banner-type-2', text: 'Mid Banner 1', adId: 'ADSTERRA_MID_1' },
                    { id: 'banner-mid-2', type: 'banner-type-3', text: 'Mid Banner 2', adId: 'ADSTERRA_MID_2' }
                ],
                bottom: [
                    { id: 'banner-bottom-1', type: 'banner-type-1', text: 'Bottom Banner', adId: 'ADSTERRA_BOTTOM_1' }
                ],
                popup: [
                    { id: 'banner-popup-1', type: 'banner-type-2', text: 'Special Offer!', adId: 'ADSTERRA_POPUP_1' }
                ],
                native: [
                    { id: 'banner-native-1', type: 'banner-type-3', text: 'Congratulations!', adId: 'ADSTERRA_NATIVE_1' }
                ]
            }
        };

        // ===== FIREBASE CONFIGURATION =====
        const firebaseConfig = {
            apiKey: "AIzaSyC4R6An9_5w0pNQpC3JpJzv60qJk7qY8V0",
            authDomain: "checkin30-7b3d5.firebaseapp.com",
            databaseURL: "https://checkin30-7b3d5-default-rtdb.firebaseio.com",
            projectId: "checkin30-7b3d5",
            storageBucket: "checkin30-7b3d5.firebasestorage.app",
            messagingSenderId: "109876543210",
            appId: "1:109876543210:web:abc123def456ghi789jkl"
        };

        // Initialize Firebase immediately
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // ===== GLOBAL VARIABLES =====
        let currentUser = null;
        let userData = null;
        let timerInterval = null;
        let visitTimerInterval = null;
        let remainingTime = CONFIG.TIMER_DURATION;
        let visitRemainingTime = CONFIG.VISIT_DURATION;
        let isTimerRunning = false;
        let isVisitTimerRunning = false;
        let currentPage = null;
        let nativeAdShown = false;
        let visitCompleted = false;
        let bannerTimers = {};
        let activeBanners = [];

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Loaded");
            
            // Show loader for 2 seconds max, then check auth
            setTimeout(() => {
                checkAuthAndLoad();
            }, 2000);
        });

        // Check authentication and load appropriate page
        function checkAuthAndLoad() {
            // Hide loader
            const appLoader = document.getElementById('app-loader');
            if (appLoader) {
                appLoader.style.display = 'none';
            }
            
            // Show app container
            const appContainer = document.getElementById('app-container');
            if (appContainer) {
                appContainer.classList.remove('hidden');
            }
            
            // Check if user is already logged in
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is logged in - go directly to dashboard
                    currentUser = user;
                    loadUserData();
                    updateNavigation(true);
                    showPage('dashboard');
                } else {
                    // No user - show login page
                    updateNavigation(false);
                    showPage('login');
                }
            });
        }

        // Update navigation based on auth state
        function updateNavigation(isLoggedIn) {
            const authLinks = document.querySelectorAll('.auth-link');
            const userLinks = document.querySelectorAll('.user-link');
            
            if (isLoggedIn) {
                authLinks.forEach(link => link.classList.add('hidden'));
                userLinks.forEach(link => link.classList.remove('hidden'));
            } else {
                authLinks.forEach(link => link.classList.remove('hidden'));
                userLinks.forEach(link => link.classList.add('hidden'));
            }
        }

        // ===== WEBSITE VISIT REQUIREMENT =====
        function checkVisitRequirement() {
            const today = new Date().toDateString();
            const lastVisitDate = localStorage.getItem('lastVisitDate');
            const visitCompletedToday = localStorage.getItem('visitCompletedToday') === 'true';
            
            if (lastVisitDate !== today) {
                localStorage.removeItem('visitCompletedToday');
                visitCompleted = false;
            } else {
                visitCompleted = visitCompletedToday;
            }
        }

        function showVisitNotice() {
            const visitNotice = document.getElementById('visitNotice');
            if (visitNotice) {
                visitNotice.classList.remove('hidden');
                visitNotice.classList.add('flex');
                document.getElementById('visitTimer').textContent = formatTime(CONFIG.VISIT_DURATION);
            }
        }

        function startVisitTimer() {
            if (isVisitTimerRunning) return;
            
            isVisitTimerRunning = true;
            visitRemainingTime = CONFIG.VISIT_DURATION;
            const visitTimerElement = document.getElementById('visitTimer');
            
            visitTimerInterval = setInterval(() => {
                visitRemainingTime--;
                
                if (visitTimerElement) {
                    visitTimerElement.textContent = formatTime(visitRemainingTime);
                }
                
                if (visitRemainingTime <= 0) {
                    clearInterval(visitTimerInterval);
                    completeVisit();
                }
            }, 1000);
        }

        function completeVisit() {
            const today = new Date().toDateString();
            localStorage.setItem('lastVisitDate', today);
            localStorage.setItem('visitCompletedToday', 'true');
            visitCompleted = true;
            
            const visitNotice = document.getElementById('visitNotice');
            if (visitNotice) {
                visitNotice.classList.add('hidden');
            }
            
            const startBtn = document.getElementById('startTimerBtn');
            if (startBtn) {
                startBtn.disabled = false;
                startBtn.innerHTML = '<i class="fas fa-play"></i> Start Timer';
            }
            
            alert('âœ… 2-minute website visit completed! You can now start the activity timer.');
        }

        // ===== BANNER AD SYSTEM =====
        function createBanner(bannerConfig, position) {
            const bannerId = bannerConfig.id;
            
            if (document.getElementById(bannerId)) {
                return;
            }
            
            const bannerHTML = `
                <div class="banner-ad ${bannerConfig.type}" id="${bannerId}">
                    <div class="banner-content">
                        <div class="ad-placeholder">
                            <div id="adsterra-${bannerId}">
                                <i class="fas fa-ad fa-2x"></i>
                                <p>${bannerConfig.text}</p>
                                <small>Banner ID: ${bannerConfig.adId}</small>
                            </div>
                        </div>
                        <button class="close-ad" onclick="closeBanner('${bannerId}')">âœ•</button>
                    </div>
                </div>
            `;
            
            const bannerContainer = document.getElementById('banner-container');
            if (bannerContainer) {
                bannerContainer.insertAdjacentHTML('beforeend', bannerHTML);
                activeBanners.push(bannerId);
                
                setTimeout(() => {
                    const bannerElement = document.getElementById(bannerId);
                    if (bannerElement) {
                        bannerElement.style.display = 'block';
                    }
                }, 100);
            }
        }

        function scheduleBannersForPage(pageName) {
            // Clear existing timers
            Object.keys(bannerTimers).forEach(timerId => {
                clearTimeout(bannerTimers[timerId]);
            });
            bannerTimers = {};
            
            // Clear active banners
            activeBanners.forEach(bannerId => {
                closeBanner(bannerId);
            });
            activeBanners = [];
            
            const intervals = CONFIG.BANNER_INTERVALS[pageName] || CONFIG.BANNER_INTERVALS.dashboard;
            
            intervals.forEach((interval, index) => {
                const timerId = setTimeout(() => {
                    if (currentPage !== pageName) return;
                    
                    let bannerConfig;
                    let position;
                    
                    if (index === 0) {
                        bannerConfig = CONFIG.BANNERS.top[0];
                        position = 'top';
                    } else if (index === intervals.length - 1) {
                        bannerConfig = CONFIG.BANNERS.bottom[0];
                        position = 'bottom';
                    } else {
                        const midIndex = Math.min(index - 1, CONFIG.BANNERS.mid.length - 1);
                        bannerConfig = CONFIG.BANNERS.mid[midIndex];
                        position = 'mid';
                    }
                    
                    if (bannerConfig) {
                        createBanner(bannerConfig, position);
                    }
                }, interval * 1000);
                
                bannerTimers[`banner-${index}`] = timerId;
            });
        }

        function closeBanner(bannerId) {
            const banner = document.getElementById(bannerId);
            if (banner) {
                banner.style.display = 'none';
                
                const index = activeBanners.indexOf(bannerId);
                if (index > -1) {
                    activeBanners.splice(index, 1);
                }
                
                if (!visitCompleted && currentPage === 'activity') {
                    setTimeout(() => {
                        showVisitNotice();
                    }, 500);
                }
            }
        }

        function showNativeAdPage() {
            if (nativeAdShown) return;
            
            nativeAdShown = true;
            
            const nativeBanner = CONFIG.BANNERS.native[0];
            const nativeAdHTML = `
                <div class="native-ad-page">
                    <div class="native-ad-header">
                        Daily Check-In Complete! ðŸŽ‰
                    </div>
                    <button class="native-ad-close" onclick="closeNativeAd()">âœ•</button>
                    <div class="native-ad-content">
                        <div style="text-align: center; max-width: 400px; width: 100%;">
                            <div class="banner-ad ${nativeBanner.type}" style="margin: 20px auto; max-width: 350px;">
                                <div class="banner-content">
                                    <div class="ad-placeholder">
                                        <div id="adsterra-${nativeBanner.id}">
                                            <i class="fas fa-ad fa-2x"></i>
                                            <p>${nativeBanner.text}</p>
                                            <small>Banner ID: ${nativeBanner.adId}</small>
                                        </div>
                                    </div>
                                    <button class="close-ad" onclick="closeNativeAd()">âœ•</button>
                                </div>
                            </div>
                            
                            <h2 style="margin: 20px 0; color: var(--primary);">
                                <i class="fas fa-trophy"></i> Points Earned: +${CONFIG.DAILY_POINTS}
                            </h2>
                            <p style="margin-bottom: 20px;">Your points have been added to your account.</p>
                            <button onclick="closeNativeAdAndRedirect()" class="btn btn-primary" style="margin-top: 10px; padding: 12px 30px;">
                                <i class="fas fa-check"></i> Continue to Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', nativeAdHTML);
        }

        function closeNativeAd() {
            const nativeAd = document.querySelector('.native-ad-page');
            if (nativeAd) {
                nativeAd.remove();
                nativeAdShown = false;
                showPage('dashboard');
            }
        }

        function closeNativeAdAndRedirect() {
            closeNativeAd();
            showPage('dashboard');
        }

        // ===== PAGE SYSTEM =====
        function showPage(pageName) {
            currentPage = pageName;
            
            const pageContainer = document.getElementById('page-container');
            if (!pageContainer) return;
            
            // Show page loading
            pageContainer.innerHTML = `
                <div class="page-loading">
                    <div class="page-spinner"></div>
                    <p>Loading...</p>
                </div>
            `;
            
            // Load page content
            let html = '';
            switch(pageName) {
                case 'login':
                    html = getLoginPage();
                    break;
                case 'dashboard':
                    html = getDashboardPage();
                    break;
                case 'activity':
                    html = getActivityPage();
                    break;
                case 'reward':
                    html = getRewardPage();
                    break;
                case 'terms':
                    html = getTermsPage();
                    break;
                case 'privacy':
                    html = getPrivacyPage();
                    break;
                case 'disclaimer':
                    html = getDisclaimerPage();
                    break;
                default:
                    html = getDashboardPage();
            }
            
            // Show page immediately
            setTimeout(() => {
                pageContainer.innerHTML = html;
                scheduleBannersForPage(pageName);
                initPage(pageName);
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                const activeLink = document.querySelector(`[onclick*="showPage('${pageName}')"]`);
                if (activeLink) activeLink.classList.add('active');
            }, 300);
        }

        // ===== PAGE TEMPLATES =====
        function getLoginPage() {
            return `
                <div class="auth-container">
                    <div class="auth-card">
                        <div class="auth-header">
                            <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                                <i class="fas fa-calendar-check"></i>
                                <span>CheckIn30</span>
                            </div>
                            <h1>Welcome Back</h1>
                            <p>Sign in to continue your daily check-in streak</p>
                        </div>
                        
                        <div id="loginForm">
                            <div class="form-group">
                                <label class="form-label" for="email">Email</label>
                                <input type="email" id="email" class="form-input" placeholder="Enter your email" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="password">Password</label>
                                <input type="password" id="password" class="form-input" placeholder="Enter your password" required>
                            </div>
                            
                            <button onclick="loginWithEmail()" class="btn btn-primary btn-block">
                                <i class="fas fa-sign-in-alt"></i> Sign In
                            </button>
                            
                            <div class="divider">
                                <span>Or continue with</span>
                            </div>
                            
                            <button onclick="loginWithGoogle()" class="btn btn-google btn-block">
                                <i class="fab fa-google"></i> Google
                            </button>
                            
                            <div class="auth-footer">
                                <p>Don't have an account? <a href="#" onclick="showRegisterForm()">Sign up</a></p>
                            </div>
                        </div>
                        
                        <div id="registerForm" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="regEmail">Email</label>
                                <input type="email" id="regEmail" class="form-input" placeholder="Enter your email" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="regPassword">Password</label>
                                <input type="password" id="regPassword" class="form-input" placeholder="Create a password (min. 6 characters)" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="confirmPassword">Confirm Password</label>
                                <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm your password" required>
                            </div>
                            
                            <button onclick="registerWithEmail()" class="btn btn-primary btn-block">
                                <i class="fas fa-user-plus"></i> Create Account
                            </button>
                            
                            <div class="auth-footer">
                                <p>Already have an account? <a href="#" onclick="showLoginForm()">Sign in</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDashboardPage() {
            const progress = userData ? Math.min((userData.activeDays / CONFIG.REQUIRED_DAYS) * 100, 100) : 0;
            
            return `
                <div class="dashboard-container">
                    <h1 class="mb-20">Dashboard</h1>
                    <p class="text-center mb-30">Track your daily progress and earn rewards</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-coins"></i>
                            <h3>${userData?.points || 0}</h3>
                            <p>Total Points</p>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-calendar-day"></i>
                            <h3>${userData?.activeDays || 0}/${CONFIG.REQUIRED_DAYS}</h3>
                            <p>Active Days</p>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-trophy"></i>
                            <h3>${userData?.rewardStatus || 'Not Eligible'}</h3>
                            <p>Reward Status</p>
                        </div>
                    </div>
                    
                    <div class="progress-section">
                        <div class="progress-header">
                            <h2>30-Day Progress</h2>
                            <span class="status-badge ${userData?.rewardRequested ? 'pending' : ''}">
                                <i class="fas ${userData?.rewardRequested ? 'fa-clock' : 'fa-calendar-check'}"></i>
                                ${userData?.rewardRequested ? 'Reward Pending' : 'In Progress'}
                            </span>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-bar" style="width: ${progress}%"></div>
                        </div>
                        
                        <div class="progress-text">
                            <span>Start</span>
                            <span>${Math.round(progress)}% Complete</span>
                            <span>30 Days</span>
                        </div>
                    </div>
                    
                    ${userData?.rewardRequested ? `
                    <div class="reward-status">
                        <h3 class="mb-20">Reward Status</h3>
                        <div class="status-badge ${userData.rewardStatus === 'SUCCESS' ? 'success' : 'pending'}">
                            <i class="fas ${userData.rewardStatus === 'SUCCESS' ? 'fa-check-circle' : 'fa-clock'}"></i>
                            ${userData.rewardStatus || 'PENDING'}
                        </div>
                        <p class="mt-20">Your reward will be sent within 3 working days.</p>
                    </div>
                    ` : ''}
                    
                    <!-- Connect Section -->
                    <div class="connect-section" id="connectSection">
                        <h2>Connect Your Account</h2>
                        <p>Connect your Gmail to sync your activity</p>
                        <div class="connect-form">
                            <input type="email" id="connectEmail" class="connect-input" placeholder="Enter your Gmail address" value="${userData?.email || ''}">
                            <button class="connect-btn" onclick="connectGmail()">
                                <i class="fab fa-google"></i> Connect Gmail
                            </button>
                        </div>
                        <p style="font-size: 12px; margin-top: 10px;">We'll never share your email with anyone else.</p>
                    </div>
                    
                    <div class="text-center mt-30">
                        <button onclick="showPage('activity')" class="btn btn-primary btn-lg">
                            <i class="fas fa-play-circle"></i> Start Daily Activity
                        </button>
                    </div>
                </div>
            `;
        }

        function getActivityPage() {
            const today = new Date().toDateString();
            const canStartActivity = !userData?.lastActivityDate || userData.lastActivityDate !== today;
            
            return `
                <div class="activity-container">
                    <h1 class="mb-20">Daily Activity</h1>
                    <p class="text-center mb-30">Complete your daily check-in to earn points</p>
                    
                    <div class="timer-card">
                        <h2 class="mb-20">Daily Timer</h2>
                        <p class="mb-20">Stay on this page for 2 minutes to complete today's activity</p>
                        
                        <div class="timer-progress">
                            <svg class="timer-circle" viewBox="0 0 100 100">
                                <circle class="timer-circle-bg" cx="50" cy="50" r="45"></circle>
                                <circle class="timer-circle-progress" cx="50" cy="50" r="45" 
                                        stroke-dasharray="283" 
                                        stroke-dashoffset="${283 - (283 * (remainingTime / CONFIG.TIMER_DURATION))}">
                                </circle>
                            </svg>
                            <div class="timer-display" id="timerDisplay">
                                ${formatTime(remainingTime)}
                            </div>
                        </div>
                        
                        <div class="timer-instructions">
                            <h4 class="mb-10">Activity Process:</h4>
                            <ul>
                                <li><strong>Step 1:</strong> First visit website for 2 minutes (browse pages, close ads)</li>
                                <li><strong>Step 2:</strong> After visit completion, timer button will be enabled</li>
                                <li><strong>Step 3:</strong> Click "Start Timer" and stay on page for 2 minutes</li>
                                <li><strong>Step 4:</strong> Do not refresh or close the page</li>
                                <li><strong>Step 5:</strong> Points will be awarded automatically after timer ends</li>
                            </ul>
                        </div>
                        
                        <button onclick="${canStartActivity ? 'startActivityProcess()' : 'alert(\'You have already completed today\\'s activity!\')'}" 
                                class="btn btn-primary btn-block" 
                                ${!canStartActivity ? 'disabled' : ''}
                                id="startTimerBtn">
                            <i class="fas ${canStartActivity ? 'fa-play' : 'fa-check'}"></i>
                            ${canStartActivity ? (visitCompleted ? 'Start Timer' : 'Start Activity Process') : 'Already Completed Today'}
                        </button>
                        
                        <div class="mt-20 text-center" style="color: var(--gray); font-size: 0.9rem;">
                            <i class="fas fa-info-circle"></i> ${visitCompleted ? 'âœ… Website visit completed' : 'âš ï¸ First visit website for 2 minutes'}
                        </div>
                    </div>
                </div>
            `;
        }

        function getRewardPage() {
            const canRequest = userData?.activeDays >= CONFIG.REQUIRED_DAYS && !userData?.rewardRequested;
            
            return `
                <div class="dashboard-container">
                    <h1 class="mb-20">Reward Request</h1>
                    
                    ${!canRequest ? `
                        <div class="reward-info">
                            <h3>Eligibility Requirements</h3>
                            <p>To request a reward, you need:</p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>Complete ${CONFIG.REQUIRED_DAYS} active days</li>
                                <li>Not have a pending reward request</li>
                            </ul>
                            <p class="mt-20">Your progress: ${userData?.activeDays || 0}/${CONFIG.REQUIRED_DAYS} days</p>
                        </div>
                    ` : `
                        <div class="reward-form">
                            <div class="reward-info">
                                <h3>ðŸŽ‰ Congratulations!</h3>
                                <p>You have completed ${CONFIG.REQUIRED_DAYS} days of active participation.</p>
                                <p class="mt-10"><strong>Reward will be sent within 3 working days.</strong></p>
                            </div>
                            
                            <div class="disclaimer">
                                <p><strong>Note:</strong> Submitting a request does not guarantee the top reward.</p>
                                <p class="mt-10">All users may receive a discretionary bonus based on platform earnings.</p>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="emailField">Email Address</label>
                                <input type="email" id="emailField" class="form-input" value="${userData?.email || ''}" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="upiID">UPI ID</label>
                                <input type="text" id="upiID" class="form-input" placeholder="Enter your UPI ID (e.g., username@upi)" required>
                                <small style="color: var(--gray); margin-top: 5px; display: block;">Enter valid UPI ID to receive reward</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="pointsInfo">Points to be Deducted</label>
                                <input type="text" id="pointsInfo" class="form-input" value="50 points will be deducted" readonly>
                            </div>
                            
                            <button onclick="submitRewardRequest()" class="btn btn-success btn-block mt-20">
                                <i class="fas fa-paper-plane"></i> Submit Reward Request
                            </button>
                        </div>
                    `}
                </div>
            `;
        }

        function getTermsPage() {
            return `
                <div class="dashboard-container">
                    <h1>Terms of Service</h1>
                    <div class="reward-info mt-20">
                        <h3>Last Updated: ${new Date().toLocaleDateString()}</h3>
                        <p>By using CheckIn30, you agree to these terms:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Users must complete daily activities honestly</li>
                            <li>One account per user is allowed</li>
                            <li>Rewards are discretionary and not guaranteed</li>
                            <li>We reserve the right to suspend accounts for abuse</li>
                            <li>All decisions regarding rewards are final</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function getPrivacyPage() {
            return `
                <div class="dashboard-container">
                    <h1>Privacy Policy</h1>
                    <div class="reward-info mt-20">
                        <h3>Data Collection and Usage</h3>
                        <p>We collect and use your data as follows:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Email address for account identification</li>
                            <li>Activity data for progress tracking</li>
                            <li>UPI ID for reward distribution (when requested)</li>
                            <li>Data is stored securely in Firebase</li>
                            <li>We don't share your data with third parties</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function getDisclaimerPage() {
            return `
                <div class="dashboard-container">
                    <h1>Disclaimer</h1>
                    <div class="disclaimer mt-20" style="margin: 0;">
                        <h3>Important Information</h3>
                        <p><strong>CheckIn30 is an engagement tracking platform.</strong></p>
                        <p class="mt-10">Rewards are discretionary and not guaranteed income.</p>
                        <p class="mt-10">The platform is for entertainment and engagement purposes.</p>
                        <p class="mt-10">Participation does not guarantee monetary rewards.</p>
                        <p class="mt-10">All reward decisions are at the discretion of the platform.</p>
                    </div>
                </div>
            `;
        }

        // ===== ACTIVITY PROCESS FUNCTIONS =====
        function startActivityProcess() {
            if (!visitCompleted) {
                showVisitNotice();
                return;
            }
            startTimer();
        }

        function startTimer() {
            if (isTimerRunning) return;
            
            isTimerRunning = true;
            remainingTime = CONFIG.TIMER_DURATION;
            const startBtn = document.getElementById('startTimerBtn');
            if (startBtn) {
                startBtn.disabled = true;
                startBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Timer Running...';
            }
            
            timerInterval = setInterval(() => {
                remainingTime--;
                
                const timerDisplay = document.getElementById('timerDisplay');
                if (timerDisplay) {
                    timerDisplay.textContent = formatTime(remainingTime);
                }
                
                const progressCircle = document.querySelector('.timer-circle-progress');
                if (progressCircle) {
                    const progress = 283 - (283 * (remainingTime / CONFIG.TIMER_DURATION));
                    progressCircle.style.strokeDashoffset = progress;
                }
                
                if (remainingTime <= 0) {
                    clearInterval(timerInterval);
                    completeDailyActivity();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        async function completeDailyActivity() {
            const today = new Date().toDateString();
            
            if (userData?.lastActivityDate === today) {
                alert('You have already completed today\'s activity!');
                return;
            }
            
            try {
                const userRef = database.ref('users/' + currentUser.uid);
                const updates = {
                    points: (userData?.points || 0) + CONFIG.DAILY_POINTS,
                    activeDays: (userData?.activeDays || 0) + 1,
                    lastActivityDate: today,
                    updatedAt: Date.now()
                };
                
                await userRef.update(updates);
                
                userData = { ...userData, ...updates };
                
                setTimeout(() => {
                    showNativeAdPage();
                }, 500);
                
                setTimeout(checkRewardPopup, 1000);
                
            } catch (error) {
                console.error('Error completing daily activity:', error);
                alert('Error completing activity. Please try again.');
            }
        }

        // ===== REWARD SYSTEM FUNCTIONS =====
        function checkRewardPopup() {
            if (!userData || userData.rewardRequested) return;
            
            if (userData.activeDays >= CONFIG.REQUIRED_DAYS) {
                const lastPopup = localStorage.getItem('rewardPopupShown');
                const now = Date.now();
                
                if (!lastPopup || (now - lastPopup) > CONFIG.REWARD_POPUP_DELAY) {
                    setTimeout(showRewardPopup, 2000);
                }
            }
        }

        function showRewardPopup() {
            const popupBanner = CONFIG.BANNERS.popup[0];
            
            const popupHTML = `
                <div class="modal-overlay" id="rewardPopup">
                    <div class="modal-content">
                        <div class="banner-ad ${popupBanner.type}" style="margin-bottom: 20px;">
                            <div class="banner-content">
                                <div class="ad-placeholder">
                                    <div id="adsterra-${popupBanner.id}">
                                        <i class="fas fa-ad fa-2x"></i>
                                        <p>${popupBanner.text}</p>
                                        <small>Banner ID: ${popupBanner.adId}</small>
                                    </div>
                                </div>
                                <button class="close-ad" onclick="document.getElementById('rewardPopup').style.display='none'">âœ•</button>
                            </div>
                        </div>
                        
                        <div class="modal-header">
                            <i class="fas fa-trophy"></i>
                            <h2>Congratulations! ðŸŽ‰</h2>
                            <p>You have completed ${CONFIG.REQUIRED_DAYS} days!</p>
                        </div>
                        
                        <div class="modal-body">
                            <p><strong>Reward request submit karne par aapka reward 3 din me aapke pass send hoga.</strong></p>
                            <p class="mt-20">50 points will be deducted for the reward request.</p>
                            <div class="disclaimer mt-20">
                                <p>Rewards are discretionary and based on platform earnings.</p>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button onclick="closeRewardPopup()" class="btn btn-secondary">
                                <i class="fas fa-clock"></i> Later
                            </button>
                            <button onclick="requestReward()" class="btn btn-primary">
                                <i class="fas fa-gift"></i> Request Reward
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', popupHTML);
            
            // Show the popup
            setTimeout(() => {
                const popup = document.getElementById('rewardPopup');
                if (popup) {
                    popup.style.display = 'flex';
                }
            }, 100);
            
            localStorage.setItem('rewardPopupShown', Date.now());
        }

        function closeRewardPopup() {
            const popup = document.getElementById('rewardPopup');
            if (popup) {
                popup.style.display = 'none';
            }
        }

        function requestReward() {
            closeRewardPopup();
            showPage('reward');
        }

        // ===== TELEGRAM NOTIFICATION =====
        async function sendTelegramNotification(message) {
            try {
                const url = `https://api.telegram.org/bot${CONFIG.TELEGRAM_BOT_TOKEN}/sendMessage`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: CONFIG.TELEGRAM_CHAT_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                return response.ok;
            } catch (error) {
                console.error('Error sending Telegram notification:', error);
                return false;
            }
        }

        async function submitRewardRequest() {
            const upiID = document.getElementById('upiID')?.value.trim();
            
            if (!upiID) {
                alert('Please enter your UPI ID');
                return;
            }
            
            if (!upiID.includes('@')) {
                alert('Please enter a valid UPI ID (e.g., username@upi)');
                return;
            }
            
            try {
                const userRef = database.ref('users/' + currentUser.uid);
                const updates = {
                    rewardRequested: true,
                    rewardStatus: 'PENDING',
                    upiID: upiID,
                    requestTime: Date.now(),
                    points: Math.max((userData?.points || 0) - 50, 0),
                    updatedAt: Date.now()
                };
                
                await userRef.update(updates);
                
                userData = { ...userData, ...updates };
                
                const telegramSent = await sendTelegramNotification(
                    `âœ… Reward Request Submitted\n` +
                    `User: ${userData.email}\n` +
                    `Points deducted: 50\n` +
                    `Remaining Points: ${userData.points}\n` +
                    `UPI: ${upiID}\n` +
                    `Active Days: ${userData.activeDays}\n` +
                    `Time: ${new Date().toLocaleString()}`
                );
                
                if (telegramSent) {
                    alert('âœ… Reward request sent successfully! Reward 3 din me aapke pass aayega.');
                } else {
                    alert('âœ… Reward request submitted! (Telegram notification failed)');
                }
                
                showPage('dashboard');
                
            } catch (error) {
                console.error('Error submitting reward request:', error);
                alert('Error submitting request. Please try again.');
            }
        }

        // ===== LOAD USER DATA =====
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const userRef = database.ref('users/' + currentUser.uid);
                const snapshot = await userRef.once('value');
                
                if (snapshot.exists()) {
                    userData = snapshot.val();
                } else {
                    userData = {
                        email: currentUser.email,
                        points: 0,
                        activeDays: 0,
                        lastActivityDate: null,
                        rewardRequested: false,
                        rewardStatus: null,
                        upiID: '',
                        requestTime: null,
                        createdAt: Date.now()
                    };
                    await userRef.set(userData);
                }
                
                checkRewardPopup();
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // ===== AUTH FUNCTIONS =====
        function showLoginForm() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        async function loginWithEmail() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        async function registerWithEmail() {
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            try {
                await auth.createUserWithEmailAndPassword(email, password);
            } catch (error) {
                alert('Registration failed: ' + error.message);
            }
        }

        async function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                alert('Google login failed: ' + error.message);
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                showPage('login');
            } catch (error) {
                alert('Logout failed: ' + error.message);
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function toggleMenu() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        }

        function connectGmail() {
            const email = document.getElementById('connectEmail').value;
            if (email) {
                alert(`âœ… Gmail ${email} connected successfully!\n\nNow you can sync your activity data.`);
            } else {
                alert('Please enter your Gmail address');
            }
        }

        function initPage(pageName) {
            if (pageName === 'activity') {
                checkVisitRequirement();
                const today = new Date().toDateString();
                const startBtn = document.getElementById('startTimerBtn');
                
                if (startBtn) {
                    if (userData?.lastActivityDate === today) {
                        startBtn.disabled = true;
                        startBtn.innerHTML = '<i class="fas fa-check"></i> Already Completed Today';
                    } else if (!visitCompleted) {
                        startBtn.disabled = false;
                        startBtn.innerHTML = '<i class="fas fa-play"></i> Start Activity Process';
                    } else {
                        startBtn.disabled = false;
                        startBtn.innerHTML = '<i class="fas fa-play"></i> Start Timer';
                    }
                }
            }
        }
    </script>
</body>
</html>
