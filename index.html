<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CheckIn30 - Earn Daily Rewards</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --gray: #6c757d;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Screen Management */
        .screen {
            display: none;
            min-height: 100vh;
        }

        .screen.active {
            display: block;
        }

        /* Loading Screen */
        #loading-screen {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        .loading-container {
            text-align: center;
            padding: 30px;
        }

        .logo-animation {
            margin-bottom: 30px;
            animation: bounce 2s infinite;
        }

        .logo-icon {
            font-size: 5rem;
            color: white;
            margin-bottom: 15px;
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #fff, var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }

        .loading-spinner {
            width: 70px;
            height: 70px;
            border: 6px solid rgba(255, 255, 255, 0.2);
            border-top: 6px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }

        /* Auth Screen */
        #auth-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.6s ease;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .auth-logo i {
            font-size: 3rem;
            color: var(--accent);
        }

        .auth-logo h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
        }

        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .optional {
            color: rgba(255, 255, 255, 0.6);
            font-weight: normal;
        }

        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
            min-height: 20px;
        }

        /* Auth Banner */
        .auth-banner {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.2), rgba(58, 12, 163, 0.2));
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-banner i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .auth-banner h4 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .auth-banner p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        /* Buttons */
        .btn {
            padding: 16px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--accent), #3a86ff);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e67e22);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
        }

        .btn-outline:hover {
            background: var(--accent);
            color: white;
        }

        .btn-large {
            padding: 18px 35px;
            font-size: 1.1rem;
        }

        .btn-full {
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Main App */
        #app-container {
            display: none;
            min-height: 100vh;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
            padding: 12px 0;
            display: flex;
            justify-content: space-around;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 15px;
            min-width: 80px;
        }

        .nav-item.active {
            color: var(--accent);
            background: rgba(76, 201, 240, 0.1);
        }

        .nav-item i {
            font-size: 1.3rem;
        }

        .nav-item span {
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            padding: 25px 20px 100px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        /* Home Section */
        .welcome-card {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.15), rgba(58, 12, 163, 0.15));
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .user-info h3 {
            font-size: 1.8rem;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .user-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .points-badge {
            background: linear-gradient(135deg, #7209b7, #3a0ca3);
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(114, 9, 183, 0.3);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.08);
        }

        .stat-card i {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .stat-card h3 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            color: white;
        }

        .stat-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Timer Section */
        .timer-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timer-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .timer-header i {
            font-size: 2rem;
            color: var(--accent);
        }

        .timer-info h4 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            color: white;
        }

        .timer-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .timer-progress {
            margin: 20px 0;
        }

        .timer-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 5px;
            width: 0%;
            transition: width 1s linear;
        }

        .timer-text {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .feature-icon i {
            font-size: 1.8rem;
            color: white;
        }

        .feature-card h4 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: white;
        }

        .feature-card p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Ads Section */
        .ads-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ads-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .ads-header h3 {
            font-size: 1.3rem;
            color: white;
        }

        .sponsored-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .ads-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .ad-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .ad-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent);
        }

        .ad-placeholder {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            margin-top: 20px;
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }

        .ad-placeholder i {
            font-size: 2.5rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        /* Rewards Section */
        .rewards-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .reward-card {
            background: linear-gradient(135deg, rgba(114, 9, 183, 0.15), rgba(58, 12, 163, 0.15));
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .reward-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .reward-header i {
            font-size: 2.5rem;
            color: #7209b7;
        }

        .reward-header h3 {
            font-size: 1.8rem;
            color: white;
        }

        .reward-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .progress-container {
            margin: 30px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: rgba(255, 255, 255, 0.8);
        }

        .progress-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #7209b7, var(--primary));
            border-radius: 6px;
            width: 0%;
            transition: width 1s ease;
        }

        .reward-status {
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin: 25px 0;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .reward-status i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .status-not-eligible i { color: var(--gray); }
        .status-eligible i { color: var(--success); }
        .status-pending i { color: var(--warning); }
        .status-completed i { color: var(--success); }

        .reward-form {
            margin-top: 25px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Referral Section */
        .referral-card {
            background: linear-gradient(135deg, rgba(76, 201, 240, 0.15), rgba(67, 97, 238, 0.15));
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .referral-code {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin: 25px 0;
            font-family: monospace;
            font-size: 1.8rem;
            letter-spacing: 3px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            color: var(--accent);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 25px 0;
        }

        .referral-stat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
        }

        .referral-stat h4 {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--accent);
        }

        .referral-stat p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }

        .referral-rules {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
        }

        .referral-rules h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .referral-rules ul {
            list-style: none;
            padding-left: 0;
        }

        .referral-rules li {
            padding: 10px 0;
            color: rgba(255, 255, 255, 0.8);
            position: relative;
            padding-left: 30px;
        }

        .referral-rules li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Profile Section */
        .profile-card {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15), rgba(255, 149, 0, 0.15));
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 25px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-avatar i {
            font-size: 3rem;
            color: white;
        }

        .profile-info h3 {
            font-size: 1.8rem;
            color: white;
            margin-bottom: 8px;
        }

        .profile-info p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95rem;
        }

        .profile-details {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        /* Popup Modals */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .popup-overlay.active {
            display: flex;
        }

        .popup-content {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(30px);
            border-radius: 25px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: popupSlideUp 0.4s ease;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .popup-header h3 {
            font-size: 1.8rem;
            color: var(--accent);
        }

        .popup-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .popup-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .popup-body {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
        }

        .popup-ad {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin: 25px 0;
            border: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .popup-ad-badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 15px;
        }

        .popup-timer {
            text-align: center;
            margin: 25px 0;
            font-size: 2rem;
            color: var(--accent);
            font-weight: bold;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 25px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
        }

        .contact-btn {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            padding: 12px 25px;
            border-radius: 12px;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .contact-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes popupSlideUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            z-index: 3000;
            animation: slideUp 0.3s ease;
            display: none;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .toast.active {
            display: block;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .stats-grid,
            .features-grid,
            .ads-grid,
            .referral-stats {
                grid-template-columns: 1fr;
            }

            .auth-container {
                padding: 25px;
                margin: 10px;
            }

            .main-content {
                padding: 20px 15px 120px;
            }

            .popup-content {
                margin: 10px;
            }

            .logo-text {
                font-size: 2.5rem;
            }

            .nav-item {
                min-width: 70px;
                padding: 8px 15px;
            }
        }

        @media (min-width: 768px) {
            .bottom-nav {
                max-width: 768px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: 25px 25px 0 0;
                bottom: 20px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(76, 201, 240, 0.5);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(76, 201, 240, 0.7);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="screen active">
        <div class="loading-container">
            <div class="logo-animation">
                <i class="fas fa-calendar-check logo-icon"></i>
                <h1 class="logo-text">CheckIn30</h1>
            </div>
            <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.1rem; margin-bottom: 20px;">
                Loading your rewards dashboard...
            </p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-calendar-check"></i>
                    <h2>CheckIn30</h2>
                </div>
                <p class="auth-subtitle">Daily check-ins, consistent rewards</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="register">Register</button>
            </div>
            
            <div id="login-form" class="auth-form active">
                <div class="form-group">
                    <label for="login-email">Email Address</label>
                    <input type="email" id="login-email" placeholder="Enter your email" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password" autocomplete="current-password">
                </div>
                <button id="login-btn" class="btn btn-primary btn-full">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                <p id="login-error" class="error-message"></p>
            </div>
            
            <div id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="register-email">Email Address</label>
                    <input type="email" id="register-email" placeholder="Enter your email" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" placeholder="Minimum 6 characters" autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label for="referral-code-input">Referral Code <span class="optional">(Optional)</span></label>
                    <input type="text" id="referral-code-input" placeholder="Enter friend's referral code">
                    <small style="color: rgba(255, 255, 255, 0.5); display: block; margin-top: 5px;">
                        Get bonus points if code is valid
                    </small>
                </div>
                <button id="register-btn" class="btn btn-primary btn-full">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                <p id="register-error" class="error-message"></p>
            </div>
            
            <!-- Auth Banner Ad -->
            <div class="auth-banner">
                <i class="fas fa-gem"></i>
                <h4>Start Earning Today!</h4>
                <p>Complete daily check-ins for 30 days</p>
                <p>Earn amazing rewards with simple clicks</p>
                <small style="color: rgba(255, 255, 255, 0.5);">[Adstra Code Here - Banner 1]</small>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-container" class="screen">
        <!-- Main Content -->
        <main class="main-content">
            <!-- Home Section -->
            <section id="home-section" class="content-section active">
                <div class="welcome-card">
                    <div class="welcome-header">
                        <div class="user-info">
                            <h3 id="user-greeting">Welcome!</h3>
                            <p id="user-email">user@example.com</p>
                        </div>
                        <div class="points-badge">
                            <i class="fas fa-coins"></i>
                            <span id="user-points">0</span> Points
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-fire"></i>
                            <h3 id="streak-days">0</h3>
                            <p>Day Streak</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-calendar-check"></i>
                            <h3 id="active-days">0</h3>
                            <p>Active Days</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-clock"></i>
                            <h3 id="days-left">30</h3>
                            <p>Days Left</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-trophy"></i>
                            <h3 id="reward-status-icon">❌</h3>
                            <p>Reward Status</p>
                        </div>
                    </div>
                </div>

                <!-- Timer Section -->
                <div class="timer-section">
                    <div class="timer-header">
                        <i class="fas fa-hourglass-half"></i>
                        <div class="timer-info">
                            <h4>Daily Check-in Timer</h4>
                            <p id="timer-message">⏳ Explore website for 2 minutes to unlock check-in</p>
                        </div>
                    </div>
                    
                    <div class="timer-progress">
                        <div class="timer-bar">
                            <div id="timer-fill" class="timer-fill"></div>
                        </div>
                        <div class="timer-text">
                            <span>Time Spent:</span>
                            <span id="timer-display">0:00 / 2:00</span>
                        </div>
                    </div>
                    
                    <button id="checkin-btn" class="btn btn-primary btn-full" style="margin-top: 20px;" disabled>
                        <i class="fas fa-lock"></i>
                        <span id="checkin-text">Unlock Daily Check-in</span>
                    </button>
                </div>

                <!-- Features -->
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <h4>Daily Rewards</h4>
                        <p>Earn 10 points every day with simple check-ins</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h4>Trusted System</h4>
                        <p>Secure platform with verified payouts</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h4>Fast Processing</h4>
                        <p>Rewards delivered within 3 days</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h4>Refer Friends</h4>
                        <p>Earn 5 bonus points per referral</p>
                    </div>
                </div>

                <!-- Ads Section -->
                <div class="ads-section">
                    <div class="ads-header">
                        <h3>Sponsored Content</h3>
                        <span class="sponsored-badge">Advertisement</span>
                    </div>
                    
                    <div class="ads-grid">
                        <div class="ad-item">[Adstra Code Here - Ad 2]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 3]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 4]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 5]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 6]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 7]</div>
                    </div>
                    
                    <div class="ad-placeholder">
                        <i class="fas fa-ad"></i>
                        <p>Premium Advertisement Space</p>
                        <small>[Adstra Code Here - Ad 8]</small>
                    </div>
                </div>
            </section>

            <!-- Rewards Section -->
            <section id="rewards-section" class="content-section">
                <div class="rewards-container">
                    <div class="reward-card">
                        <div class="reward-header">
                            <i class="fas fa-award"></i>
                            <div>
                                <h3>30-Day Reward Program</h3>
                                <p>Complete 30 active days to unlock your reward</p>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-info">
                                <span>Your Progress: <strong id="progress-days">0</strong>/30 days</span>
                                <span id="progress-percent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="progress-fill" class="progress-fill"></div>
                            </div>
                        </div>
                        
                        <div id="reward-status" class="reward-status status-not-eligible">
                            <i class="fas fa-info-circle"></i>
                            <h4 id="reward-status-title">Not Eligible Yet</h4>
                            <p id="reward-message">Complete 30 active days to become eligible for reward</p>
                        </div>
                        
                        <div id="reward-form" class="reward-form" style="display: none;">
                            <h4 style="color: white; margin-bottom: 20px;">Enter UPI Details for Reward</h4>
                            <div class="form-group">
                                <label for="upi-id">UPI ID</label>
                                <input type="text" id="upi-id" placeholder="e.g., name@upi">
                                <small style="color: rgba(255, 255, 255, 0.6); display: block; margin-top: 8px;">
                                    Reward will be sent to this UPI ID within 3 days after request
                                </small>
                            </div>
                            <button id="request-reward-btn" class="btn btn-success btn-full">
                                <i class="fas fa-paper-plane"></i> Submit Reward Request
                            </button>
                        </div>
                    </div>
                    
                    <!-- More Ads -->
                    <div class="ads-section">
                        <div class="ads-header">
                            <h3>Special Offers</h3>
                            <span class="sponsored-badge">Sponsored</span>
                        </div>
                        <div class="ads-grid">
                            <div class="ad-item">[Adstra Code Here - Ad 9]</div>
                            <div class="ad-item">[Adstra Code Here - Ad 10]</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Referral Section -->
            <section id="referral-section" class="content-section">
                <div class="referral-card">
                    <div class="reward-header">
                        <i class="fas fa-user-plus"></i>
                        <div>
                            <h3>Refer & Earn</h3>
                            <p>Invite friends and earn bonus points</p>
                        </div>
                    </div>
                    
                    <div class="referral-code" id="referral-code">
                        CK30-LOADING
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <button id="copy-referral-btn" class="btn btn-secondary" style="flex: 1;">
                            <i class="fas fa-copy"></i> Copy Code
                        </button>
                        <button id="share-referral-btn" class="btn btn-outline" style="flex: 1;">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                    
                    <div class="referral-stats">
                        <div class="referral-stat">
                            <h4 id="total-referrals">0</h4>
                            <p>Total Referrals</p>
                        </div>
                        <div class="referral-stat">
                            <h4 id="referral-earnings">0</h4>
                            <p>Points Earned</p>
                        </div>
                        <div class="referral-stat">
                            <h4 id="monthly-limit">5</h4>
                            <p>Monthly Limit</p>
                        </div>
                        <div class="referral-stat">
                            <h4 id="referrals-left">5</h4>
                            <p>Left This Month</p>
                        </div>
                    </div>
                    
                    <div class="referral-rules">
                        <h4>Referral Rules:</h4>
                        <ul>
                            <li>Each user gets a unique referral code</li>
                            <li>Earn +5 points per successful referral</li>
                            <li>Referred user must complete 3 daily check-ins</li>
                            <li>Maximum 5 referrals rewarded per month</li>
                            <li>System automatically detects valid referrals</li>
                            <li>Points are added instantly when conditions met</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Referral Ads -->
                <div class="ads-section">
                    <div class="ads-header">
                        <h3>Recommended For You</h3>
                        <span class="sponsored-badge">Ads</span>
                    </div>
                    <div class="ad-placeholder">
                        <i class="fas fa-bullhorn"></i>
                        <p>Advertisement Space</p>
                        <small>[Adstra Code Here - Ad 11]</small>
                    </div>
                </div>
            </section>

            <!-- Profile Section -->
            <section id="profile-section" class="content-section">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h3 id="profile-email">user@example.com</h3>
                            <p>Member since <span id="join-date">Loading...</span></p>
                        </div>
                    </div>
                    
                    <div class="profile-details">
                        <div class="detail-item">
                            <span>Total Points:</span>
                            <strong id="profile-points">0</strong>
                        </div>
                        <div class="detail-item">
                            <span>Active Days:</span>
                            <strong id="profile-active-days">0</strong>
                        </div>
                        <div class="detail-item">
                            <span>Current Streak:</span>
                            <strong id="profile-streak">0 days</strong>
                        </div>
                        <div class="detail-item">
                            <span>Last Check-in:</span>
                            <strong id="last-checkin">Never</strong>
                        </div>
                        <div class="detail-item">
                            <span>Reward Status:</span>
                            <strong id="profile-reward-status">Not Eligible</strong>
                        </div>
                        <div class="detail-item">
                            <span>Referral Code:</span>
                            <strong id="profile-referral-code">Loading...</strong>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button id="reset-timer-btn" class="btn btn-outline" style="flex: 1;">
                            <i class="fas fa-redo"></i> Reset Timer
                        </button>
                        <button id="logout-btn" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
                
                <!-- Contact Section -->
                <div class="ads-section" style="text-align: center;">
                    <h3 style="color: white; margin-bottom: 15px;">Need Help?</h3>
                    <p style="color: rgba(255, 255, 255, 0.8); margin-bottom: 20px;">
                        Contact us for any queries or support. We're here to help!
                    </p>
                    <button id="contact-btn" class="contact-btn">
                        <i class="fas fa-envelope"></i> Contact Support
                    </button>
                </div>
                
                <!-- More Ads -->
                <div class="ads-section">
                    <div class="ads-header">
                        <h3>Sponsored Content</h3>
                        <span class="sponsored-badge">Advertisement</span>
                    </div>
                    <div class="ad-placeholder">
                        <i class="fas fa-ad"></i>
                        <p>Advertisement Space</p>
                        <small>[Adstra Code Here - Ad 12]</small>
                    </div>
                    <div style="margin-top: 20px;">
                        <div class="ad-item">[Adstra Code Here - Ad 13]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 14]</div>
                        <div class="ad-item">[Adstra Code Here - Ad 15]</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-section="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button class="nav-item" data-section="rewards">
                <i class="fas fa-gift"></i>
                <span>Rewards</span>
            </button>
            <button class="nav-item" data-section="referral">
                <i class="fas fa-users"></i>
                <span>Referral</span>
            </button>
            <button class="nav-item" data-section="profile">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </button>
        </nav>

        <!-- Footer -->
        <footer class="footer">
            <p>© 2024 CheckIn30 - Daily Rewards Platform</p>
            <p style="font-size: 0.85rem; margin-top: 8px; opacity: 0.5;">
                Complete 30 daily check-ins and claim your reward
            </p>
        </footer>
    </div>

    <!-- Popup Modals -->
    
    <!-- Welcome Popup -->
    <div id="welcome-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                <h3>🎉 Welcome to CheckIn30!</h3>
                <button class="popup-close" onclick="closePopup('welcome-popup')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <p>To unlock daily check-in, please explore our website for <strong>2 minutes</strong>.</p>
                <div class="popup-ad">
                    <div class="popup-ad-badge">Special Offer</div>
                    <h4>Start Your Earning Journey!</h4>
                    <p>First-time users get bonus points on first check-in</p>
                    <small>[Adstra Code Here - Welcome Ad]</small>
                </div>
                <p style="text-align: center; margin-top: 20px; color: var(--accent);">
                    <i class="fas fa-info-circle"></i> Timer starts automatically when you browse
                </p>
                <button class="btn btn-primary btn-full" style="margin-top: 25px;" onclick="closePopup('welcome-popup')">
                    <i class="fas fa-check"></i> Start Exploring
                </button>
            </div>
        </div>
    </div>

    <!-- Daily Visit Popup -->
    <div id="visit-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                <h3>⏰ Daily Visit Required</h3>
                <button class="popup-close" onclick="closePopup('visit-popup')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <p>Visit required to maintain your streak! Browse website to unlock check-in.</p>
                
                <div class="popup-ad">
                    <div class="popup-ad-badge">Advertisement</div>
                    <h4>Check Our Offers!</h4>
                    <p>Amazing deals waiting for you in ads section</p>
                    <small>[Adstra Code Here - Visit Ad]</small>
                </div>
                
                <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.95rem; margin-top: 20px;">
                    <i class="fas fa-exclamation-circle"></i> Already visited today? You can still browse but streak won't increase.
                </p>
                
                <button class="btn btn-secondary btn-full" style="margin-top: 25px;" onclick="closePopup('visit-popup')">
                    <i class="fas fa-eye"></i> Continue Browsing
                </button>
            </div>
        </div>
    </div>

    <!-- Check-in Popup -->
    <div id="checkin-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                <h3>✅ Daily Check-in</h3>
                <button class="popup-close" id="checkin-close-btn" disabled>
                    <i class="fas fa-times"></i> Close (5s)
                </button>
            </div>
            <div class="popup-body">
                <p>Complete your daily check-in to earn points and maintain streak!</p>
                
                <div class="popup-ad">
                    <div class="popup-ad-badge">Sponsored</div>
                    <h4>Limited Time Offer!</h4>
                    <p>Exclusive deal for active users only</p>
                    <small>[Adstra Code Here - Check-in Ad]</small>
                </div>
                
                <div style="text-align: center; margin: 25px 0; padding: 20px; background: rgba(76, 201, 240, 0.1); border-radius: 15px;">
                    <i class="fas fa-gift fa-3x" style="color: var(--accent);"></i>
                    <h4 style="margin-top: 15px; color: white;">+10 Points Reward</h4>
                    <p style="color: rgba(255, 255, 255, 0.7);">Complete check-in to claim your points</p>
                </div>
                
                <div id="checkin-countdown" class="popup-timer">5</div>
                <p style="text-align: center; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem;">
                    Close button will be enabled in <span id="countdown-text" style="color: var(--accent); font-weight: bold;">5</span> seconds
                </p>
            </div>
        </div>
    </div>

    <!-- Contact Popup -->
    <div id="contact-popup" class="popup-overlay">
        <div class="popup-content">
            <div class="popup-header">
                <h3>📧 Contact Support</h3>
                <button class="popup-close" onclick="closePopup('contact-popup')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="popup-body">
                <p>For any queries, support, or issues, please email us:</p>
                
                <div style="text-align: center; margin: 30px 0; padding: 25px; background: rgba(76, 201, 240, 0.1); border-radius: 20px;">
                    <i class="fas fa-envelope fa-3x" style="color: var(--accent);"></i>
                    <h3 style="margin-top: 20px;">
                        <a href="mailto:gotmprajapat00@gmail.com" style="color: var(--accent); text-decoration: none; font-size: 1.5rem;">
                            gotmprajapat00@gmail.com
                        </a>
                    </h3>
                </div>
                
                <p>We'll respond to your query within 24 hours.</p>
                
                <button class="btn btn-primary btn-full" style="margin-top: 25px;" onclick="window.open('mailto:gotmprajapat00@gmail.com')">
                    <i class="fas fa-paper-plane"></i> Send Email Now
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCVRlmw3-PCtGd5s3R-a0fJQsBF1YjPRWI",
            authDomain: "uplodify-9eb07.firebaseapp.com",
            databaseURL: "https://uplodify-9eb07-default-rtdb.firebaseio.com",
            projectId: "uplodify-9eb07",
            storageBucket: "uplodify-9eb07.firebasestorage.app",
            messagingSenderId: "158848017856",
            appId: "1:158848017856:web:94aaaf14320490d52a5425",
            measurementId: "G-1PLGMECD19"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Telegram Bot Configuration
        const TELEGRAM_BOT_TOKEN = '8367971417:AAGkV30ajQdWKjM-5AQDxYZH19OPHI51HGM';
        const TELEGRAM_CHAT_ID = '6225430212';

        // Global Variables
        let currentUser = null;
        let userData = null;
        let timerInterval = null;
        let timeLeft = 120; // 2 minutes in seconds
        let timerActive = false;
        let activityDetected = false;
        let lastActivityTime = Date.now();
        let hasShownWelcomePopup = false;
        let hasShownVisitPopup = false;
        let checkinCountdown = null;

        // DOM Elements
        const screens = {
            loading: document.getElementById('loading-screen'),
            auth: document.getElementById('auth-screen'),
            app: document.getElementById('app-container')
        };

        const popups = {
            welcome: document.getElementById('welcome-popup'),
            visit: document.getElementById('visit-popup'),
            checkin: document.getElementById('checkin-popup'),
            contact: document.getElementById('contact-popup')
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            checkAuthState();
            setupActivityDetection();
        });

        // Event Listeners
        function initializeEventListeners() {
            // Auth Tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchAuthTab(tabName);
                });
            });

            // Auth Buttons
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('register-btn').addEventListener('click', handleRegister);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    switchSection(item.dataset.section);
                });
            });

            // Check-in Button
            document.getElementById('checkin-btn').addEventListener('click', openCheckinPopup);

            // Copy Referral Code
            document.getElementById('copy-referral-btn').addEventListener('click', copyReferralCode);

            // Share Referral
            document.getElementById('share-referral-btn').addEventListener('click', shareReferral);

            // Request Reward
            document.getElementById('request-reward-btn').addEventListener('click', handleRewardRequest);

            // Reset Timer
            document.getElementById('reset-timer-btn').addEventListener('click', resetDailyTimer);

            // Logout
            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Contact Button
            document.getElementById('contact-btn').addEventListener('click', () => {
                openPopup('contact-popup');
            });

            // Check-in Close Button
            document.getElementById('checkin-close-btn').addEventListener('click', completeCheckin);
        }

        // Check Auth State
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    loadUserData();
                } else {
                    showScreen('auth');
                }
            });
        }

        // Switch Auth Tab
        function switchAuthTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.toggle('active', form.id === `${tabName}-form`);
            });
        }

        // Handle Login
        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorElement = document.getElementById('login-error');
            const button = document.getElementById('login-btn');

            if (!email || !password) {
                errorElement.textContent = 'Please enter both email and password';
                return;
            }

            try {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing In...';
                
                await auth.signInWithEmailAndPassword(email, password);
                errorElement.textContent = '';
                
                // Send Telegram notification for login
                sendTelegramNotification(`🔐 User Login\n📧 ${email}\n⏰ ${new Date().toLocaleString()}`);
                
            } catch (error) {
                errorElement.textContent = getErrorMessage(error);
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
            }
        }

        // Handle Register
        async function handleRegister() {
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const referralCode = document.getElementById('referral-code-input').value.trim();
            const errorElement = document.getElementById('register-error');
            const button = document.getElementById('register-btn');

            if (!email || !password) {
                errorElement.textContent = 'Please enter both email and password';
                return;
            }

            if (password.length < 6) {
                errorElement.textContent = 'Password must be at least 6 characters';
                return;
            }

            try {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating Account...';
                
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Generate unique referral code
                const userReferralCode = 'CK30-' + generateUniqueCode(6);
                
                // Check if referral code is valid
                let referrerId = null;
                let referredBy = null;
                
                if (referralCode) {
                    referrerId = await validateReferralCode(referralCode);
                    if (referrerId) {
                        referredBy = referralCode;
                    }
                }
                
                // Prepare user data
                const userData = {
                    email: email,
                    points: referredBy ? 5 : 0, // Bonus points for using referral code
                    activeDays: 0,
                    lastCheckIn: null,
                    rewardStatus: 'NOT_ELIGIBLE',
                    rewardRequestDate: null,
                    upi: null,
                    referralCode: userReferralCode,
                    referredBy: referredBy,
                    referralRewarded: false,
                    joinDate: new Date().toISOString(),
                    referrals: 0,
                    referralPoints: 0,
                    streak: 0,
                    monthlyReferrals: 0,
                    lastReferralMonth: new Date().getMonth(),
                    totalEarnings: 0
                };

                // Save user data to database
                await database.ref(`users/${user.uid}`).set(userData);
                
                // If valid referral code used, update referrer's data
                if (referrerId) {
                    await updateReferrerData(referrerId, user.uid, email);
                }
                
                errorElement.textContent = '';
                
                // Send Telegram notification for new registration
                const refInfo = referredBy ? ` (Referred by: ${referralCode})` : '';
                sendTelegramNotification(`🆕 New User Registered\n📧 ${email}\n🎫 Code: ${userReferralCode}${refInfo}\n⏰ ${new Date().toLocaleString()}`);
                
            } catch (error) {
                errorElement.textContent = getErrorMessage(error);
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
            }
        }

        // Handle Logout
        async function handleLogout() {
            try {
                await auth.signOut();
                currentUser = null;
                userData = null;
                stopTimer();
                showScreen('auth');
                showToast('Logged out successfully');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Load User Data
        async function loadUserData() {
            if (!currentUser) return;

            try {
                const snapshot = await database.ref(`users/${currentUser.uid}`).once('value');
                userData = snapshot.val();
                
                if (!userData) {
                    // Create user data if it doesn't exist
                    const userReferralCode = 'CK30-' + generateUniqueCode(6);
                    userData = {
                        email: currentUser.email,
                        points: 0,
                        activeDays: 0,
                        lastCheckIn: null,
                        rewardStatus: 'NOT_ELIGIBLE',
                        rewardRequestDate: null,
                        upi: null,
                        referralCode: userReferralCode,
                        referredBy: null,
                        referralRewarded: false,
                        joinDate: new Date().toISOString(),
                        referrals: 0,
                        referralPoints: 0,
                        streak: 0,
                        monthlyReferrals: 0,
                        lastReferralMonth: new Date().getMonth(),
                        totalEarnings: 0
                    };
                    
                    await database.ref(`users/${currentUser.uid}`).set(userData);
                }
                
                updateUI();
                showScreen('app');
                
                // Show popups based on user status
                showWelcomePopup();
                showVisitPopup();
                
                // Check if user can check in today
                checkDailyCheckin();
                
                // Start timer if needed
                startVisitTimer();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showToast('Error loading data. Please refresh.');
            }
        }

        // Update UI with User Data
        function updateUI() {
            if (!userData) return;

            // Update user info
            const username = userData.email.split('@')[0];
            document.getElementById('user-greeting').textContent = `Welcome, ${username}!`;
            document.getElementById('user-email').textContent = userData.email;
            document.getElementById('user-points').textContent = userData.points || 0;
            document.getElementById('profile-email').textContent = userData.email;
            document.getElementById('profile-points').textContent = userData.points || 0;
            
            // Update stats
            const streak = calculateStreak();
            const activeDays = userData.activeDays || 0;
            const daysLeft = Math.max(0, 30 - activeDays);
            
            document.getElementById('streak-days').textContent = streak;
            document.getElementById('active-days').textContent = activeDays;
            document.getElementById('days-left').textContent = daysLeft;
            document.getElementById('profile-active-days').textContent = activeDays;
            document.getElementById('profile-streak').textContent = streak + ' days';
            
            // Update reward status icon
            const rewardIcon = document.getElementById('reward-status-icon');
            const rewardStatus = userData.rewardStatus || 'NOT_ELIGIBLE';
            
            if (rewardStatus === 'COMPLETED') {
                rewardIcon.textContent = '✅';
                rewardIcon.style.color = '#2ecc71';
            } else if (rewardStatus === 'PENDING') {
                rewardIcon.textContent = '⏳';
                rewardIcon.style.color = '#f39c12';
            } else if (activeDays >= 30) {
                rewardIcon.textContent = '🎁';
                rewardIcon.style.color = '#9b59b6';
            } else {
                rewardIcon.textContent = '❌';
                rewardIcon.style.color = '#e74c3c';
            }
            
            // Update last check-in
            if (userData.lastCheckIn) {
                const lastCheckin = new Date(userData.lastCheckIn);
                const now = new Date();
                const diffHours = Math.floor((now - lastCheckin) / (1000 * 60 * 60));
                
                if (diffHours < 24) {
                    document.getElementById('last-checkin').textContent = 'Today';
                } else if (diffHours < 48) {
                    document.getElementById('last-checkin').textContent = 'Yesterday';
                } else {
                    document.getElementById('last-checkin').textContent = lastCheckin.toLocaleDateString();
                }
            } else {
                document.getElementById('last-checkin').textContent = 'Never';
            }
            
            // Update join date
            if (userData.joinDate) {
                const joinDate = new Date(userData.joinDate);
                document.getElementById('join-date').textContent = joinDate.toLocaleDateString();
            }
            
            // Update profile reward status
            document.getElementById('profile-reward-status').textContent = getRewardStatusText(rewardStatus);
            
            // Update referral section
            document.getElementById('referral-code').textContent = userData.referralCode || 'CK30-LOADING';
            document.getElementById('profile-referral-code').textContent = userData.referralCode || 'Loading...';
            document.getElementById('total-referrals').textContent = userData.referrals || 0;
            document.getElementById('referral-earnings').textContent = userData.referralPoints || 0;
            
            const currentMonth = new Date().getMonth();
            const monthlyReferrals = (userData.lastReferralMonth === currentMonth) ? (userData.monthlyReferrals || 0) : 0;
            const referralsLeft = Math.max(0, 5 - monthlyReferrals);
            document.getElementById('referrals-left').textContent = referralsLeft;
            
            // Update rewards section
            updateRewardsSection();
        }

        // Calculate Streak
        function calculateStreak() {
            if (!userData || !userData.lastCheckIn) return 0;
            
            const lastCheckIn = new Date(userData.lastCheckIn);
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // Reset time for comparison
            lastCheckIn.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            yesterday.setHours(0, 0, 0, 0);
            
            if (lastCheckIn.getTime() === today.getTime()) {
                return userData.streak || 1;
            } else if (lastCheckIn.getTime() === yesterday.getTime()) {
                return (userData.streak || 1);
            } else {
                return 0;
            }
        }

        // Show Welcome Popup
        function showWelcomePopup() {
            if (!hasShownWelcomePopup) {
                setTimeout(() => {
                    openPopup('welcome-popup');
                    hasShownWelcomePopup = true;
                }, 1000);
            }
        }

        // Show Visit Popup
        function showVisitPopup() {
            if (!hasShownVisitPopup) {
                setTimeout(() => {
                    openPopup('visit-popup');
                    hasShownVisitPopup = true;
                }, 1500);
            }
        }

        // Open Popup
        function openPopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                popup.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        // Close Popup
        function closePopup(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                popup.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // Start Visit Timer
        function startVisitTimer() {
            // Check if already checked in today
            if (userData && userData.lastCheckIn) {
                const lastCheckIn = new Date(userData.lastCheckIn);
                const today = new Date();
                
                lastCheckIn.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);
                
                if (lastCheckIn.getTime() === today.getTime()) {
                    // Already checked in today
                    updateCheckinButton(true);
                    return;
                }
            }
            
            // Start timer
            timerActive = true;
            timeLeft = 120;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                if (activityDetected) {
                    timeLeft--;
                    
                    if (timeLeft <= 0) {
                        stopTimer();
                        unlockCheckinButton();
                    } else {
                        updateTimerDisplay();
                    }
                }
            }, 1000);
        }

        // Stop Timer
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            timerActive = false;
        }

        // Update Timer Display
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            
            document.getElementById('timer-display').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')} / 2:00`;
            
            // Update progress bar
            const progress = ((120 - timeLeft) / 120) * 100;
            document.getElementById('timer-fill').style.width = `${progress}%`;
            
            // Update message
            if (timeLeft > 0) {
                document.getElementById('timer-message').textContent = 
                    `⏳ Explore website to unlock check-in (${minutes}:${seconds.toString().padStart(2, '0')} left)`;
            }
        }

        // Setup Activity Detection
        function setupActivityDetection() {
            const activityEvents = ['mousemove', 'touchstart', 'scroll', 'click', 'keydown'];
            
            activityEvents.forEach(event => {
                document.addEventListener(event, () => {
                    activityDetected = true;
                    lastActivityTime = Date.now();
                }, { passive: true });
            });
            
            // Check for inactivity every 5 seconds
            setInterval(() => {
                const inactiveTime = Date.now() - lastActivityTime;
                if (inactiveTime > 10000 && timerActive) { // 10 seconds of inactivity
                    activityDetected = false;
                    document.getElementById('timer-message').textContent = 
                        '⏳ Timer paused - interact with website to continue';
                }
            }, 5000);
        }

        // Unlock Check-in Button
        function unlockCheckinButton() {
            const button = document.getElementById('checkin-btn');
            button.disabled = false;
            button.innerHTML = '<i class="fas fa-unlock"></i> Daily Check-in Available';
            button.className = 'btn btn-success btn-full';
            document.getElementById('timer-message').textContent = '✅ Daily Check-in Available!';
            document.getElementById('timer-message').style.color = '#2ecc71';
            
            showToast('🎉 Daily check-in unlocked! Click to claim your reward.');
        }

        // Update Check-in Button
        function updateCheckinButton(completed) {
            const button = document.getElementById('checkin-btn');
            if (completed) {
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-check-circle"></i> Already Checked-in Today';
                button.className = 'btn btn-full';
                document.getElementById('timer-message').textContent = '✅ Daily check-in completed';
                document.getElementById('timer-message').style.color = '#2ecc71';
            }
        }

        // Open Check-in Popup
        function openCheckinPopup() {
            openPopup('checkin-popup');
            
            // Start countdown for close button
            let countdown = 5;
            const countdownElement = document.getElementById('countdown-text');
            const closeButton = document.getElementById('checkin-close-btn');
            const countdownDisplay = document.getElementById('checkin-countdown');
            
            // Clear any existing countdown
            if (checkinCountdown) clearInterval(checkinCountdown);
            
            checkinCountdown = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                countdownDisplay.textContent = countdown;
                closeButton.innerHTML = `<i class="fas fa-times"></i> Close (${countdown}s)`;
                
                if (countdown <= 0) {
                    clearInterval(checkinCountdown);
                    closeButton.disabled = false;
                    closeButton.innerHTML = '<i class="fas fa-times"></i> Close & Complete';
                    closeButton.style.background = 'linear-gradient(135deg, #4cc9f0, #3a86ff)';
                    closeButton.style.color = 'white';
                }
            }, 1000);
        }

        // Complete Check-in
        async function completeCheckin() {
            try {
                if (!currentUser || !userData) {
                    showToast('Error: User not found');
                    return;
                }
                
                const today = new Date();
                const lastCheckIn = userData.lastCheckIn ? new Date(userData.lastCheckIn) : null;
                
                // Check if already checked in today
                if (lastCheckIn) {
                    lastCheckIn.setHours(0, 0, 0, 0);
                    today.setHours(0, 0, 0, 0);
                    
                    if (lastCheckIn.getTime() === today.getTime()) {
                        showToast('You have already checked in today!');
                        closePopup('checkin-popup');
                        return;
                    }
                }
                
                // Calculate streak
                let streak = calculateStreak();
                if (lastCheckIn) {
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    yesterday.setHours(0, 0, 0, 0);
                    
                    if (lastCheckIn.getTime() === yesterday.getTime()) {
                        streak += 1;
                    } else {
                        streak = 1;
                    }
                } else {
                    streak = 1;
                }
                
                // Calculate points
                const basePoints = 10;
                const streakBonus = streak >= 3 ? 5 : 0;
                const pointsEarned = basePoints + streakBonus;
                const newPoints = (userData.points || 0) + pointsEarned;
                const newActiveDays = (userData.activeDays || 0) + 1;
                const totalEarnings = (userData.totalEarnings || 0) + pointsEarned;
                
                // Update user data
                const updates = {
                    lastCheckIn: new Date().toISOString(),
                    activeDays: newActiveDays,
                    points: newPoints,
                    streak: streak,
                    totalEarnings: totalEarnings
                };
                
                await database.ref(`users/${currentUser.uid}`).update(updates);
                
                // Update local userData
                Object.assign(userData, updates);
                
                // Update UI
                updateUI();
                
                // Send Telegram notification for check-in
                sendTelegramNotification(
                    `✅ Daily Check-in\n📧 ${userData.email}\n` +
                    `🎯 Day: ${newActiveDays}/30\n` +
                    `💰 Points: +${pointsEarned} (Total: ${newPoints})\n` +
                    `🔥 Streak: ${streak} days\n` +
                    `⏰ ${new Date().toLocaleString()}`
                );
                
                // Show success message
                let message = `✅ Daily check-in completed! +${basePoints} points earned.`;
                if (streakBonus > 0) {
                    message += ` +${streakBonus} streak bonus!`;
                }
                showToast(message);
                
                // Close popup
                closePopup('checkin-popup');
                
                // Update check-in button
                updateCheckinButton(true);
                
                // Reset timer for next day
                stopTimer();
                
                // Check for referral rewards (if user was referred)
                if (userData.referredBy && !userData.referralRewarded) {
                    await checkAndRewardReferrer();
                }
                
                // Check if user reached 30 days
                if (newActiveDays === 30) {
                    setTimeout(() => {
                        showToast('🎉 Congratulations! You completed 30 days! You can now request your reward.');
                    }, 1000);
                }
                
            } catch (error) {
                console.error('Error completing check-in:', error);
                showToast('Error completing check-in. Please try again.');
            }
        }

        // Check and Reward Referrer
        async function checkAndRewardReferrer() {
            if (!userData || !userData.referredBy || userData.referralRewarded) return;
            
            try {
                // Check if user has completed 3 check-ins
                if ((userData.activeDays || 0) >= 3) {
                    // Find referrer by referral code
                    const usersSnapshot = await database.ref('users').once('value');
                    let referrerId = null;
                    
                    usersSnapshot.forEach((childSnapshot) => {
                        const user = childSnapshot.val();
                        if (user.referralCode === userData.referredBy) {
                            referrerId = childSnapshot.key;
                        }
                    });
                    
                    if (!referrerId) return;
                    
                    // Get referrer's data
                    const referrerSnapshot = await database.ref(`users/${referrerId}`).once('value');
                    const referrerData = referrerSnapshot.val();
                    
                    if (!referrerData) return;
                    
                    // Check monthly limit
                    const currentMonth = new Date().getMonth();
                    const lastRewardMonth = referrerData.lastReferralMonth;
                    
                    if (lastRewardMonth === currentMonth && (referrerData.monthlyReferrals || 0) >= 5) {
                        return; // Monthly limit reached
                    }
                    
                    // Award referral points
                    const referralPoints = 5;
                    const newReferrerPoints = (referrerData.points || 0) + referralPoints;
                    const newReferrals = (referrerData.referrals || 0) + 1;
                    const newMonthlyReferrals = ((referrerData.lastReferralMonth === currentMonth) ? 
                        (referrerData.monthlyReferrals || 0) : 0) + 1;
                    const newReferralPoints = (referrerData.referralPoints || 0) + referralPoints;
                    
                    // Update referrer's data
                    await database.ref(`users/${referrerId}`).update({
                        points: newReferrerPoints,
                        referrals: newReferrals,
                        monthlyReferrals: newMonthlyReferrals,
                        lastReferralMonth: currentMonth,
                        referralPoints: newReferralPoints
                    });
                    
                    // Update current user's data
                    await database.ref(`users/${currentUser.uid}`).update({
                        referralRewarded: true
                    });
                    
                    // Send Telegram notification for referral reward
                    sendTelegramNotification(
                        `🎯 Referral Reward\n👤 Referrer: ${referrerData.email}\n` +
                        `👥 Referred: ${userData.email}\n` +
                        `💰 Points: +${referralPoints} (Total: ${newReferrerPoints})\n` +
                        `📊 Total Referrals: ${newReferrals}\n` +
                        `⏰ ${new Date().toLocaleString()}`
                    );
                    
                    // Update local userData if referrer is current user
                    if (referrerId === currentUser.uid) {
                        userData.points = newReferrerPoints;
                        userData.referrals = newReferrals;
                        userData.referralPoints = newReferralPoints;
                        updateUI();
                        showToast(`🎉 +${referralPoints} points from referral!`);
                    }
                }
            } catch (error) {
                console.error('Error rewarding referrer:', error);
            }
        }

        // Update Rewards Section
        function updateRewardsSection() {
            if (!userData) return;
            
            const activeDays = userData.activeDays || 0;
            const progressPercent = Math.min(100, (activeDays / 30) * 100);
            const rewardStatus = userData.rewardStatus || 'NOT_ELIGIBLE';
            
            document.getElementById('progress-days').textContent = activeDays;
            document.getElementById('progress-percent').textContent = `${Math.round(progressPercent)}%`;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
            
            const statusElement = document.getElementById('reward-status');
            const titleElement = document.getElementById('reward-status-title');
            const messageElement = document.getElementById('reward-message');
            const formElement = document.getElementById('reward-form');
            
            let statusClass = '';
            let title = '';
            let message = '';
            
            if (rewardStatus === 'NOT_ELIGIBLE') {
                if (activeDays < 30) {
                    statusClass = 'status-not-eligible';
                    title = 'Not Eligible Yet';
                    message = `Complete ${30 - activeDays} more days to become eligible for reward`;
                    formElement.style.display = 'none';
                } else {
                    statusClass = 'status-eligible';
                    title = '🎉 Eligible for Reward!';
                    message = 'You have completed 30 active days! Request your reward now.';
                    formElement.style.display = 'block';
                }
            } else if (rewardStatus === 'PENDING') {
                statusClass = 'status-pending';
                title = '⏳ Reward Processing';
                const requestDate = new Date(userData.rewardRequestDate);
                const deliveryDate = new Date(requestDate);
                deliveryDate.setDate(deliveryDate.getDate() + 3);
                message = `Reward requested on ${requestDate.toLocaleDateString()}. Will be sent by ${deliveryDate.toLocaleDateString()}.`;
                formElement.style.display = 'none';
            } else if (rewardStatus === 'COMPLETED') {
                statusClass = 'status-completed';
                title = '✅ Reward Sent!';
                message = `Reward successfully sent to ${userData.upi || 'your UPI ID'}`;
                formElement.style.display = 'none';
            }
            
            statusElement.className = `reward-status ${statusClass}`;
            titleElement.textContent = title;
            messageElement.textContent = message;
        }

        // Handle Reward Request
        async function handleRewardRequest() {
            const upiId = document.getElementById('upi-id').value.trim();
            
            if (!upiId) {
                showToast('Please enter your UPI ID');
                return;
            }
            
            // Simple UPI validation
            if (!upiId.includes('@') || upiId.length < 5) {
                showToast('Please enter a valid UPI ID (e.g., name@upi)');
                return;
            }
            
            if (!currentUser || !userData) {
                showToast('Error: User not found');
                return;
            }
            
            // Check if eligible
            if ((userData.activeDays || 0) < 30) {
                showToast('You need 30 active days to request reward');
                return;
            }
            
            // Check if already requested
            if (userData.rewardStatus === 'PENDING' || userData.rewardStatus === 'COMPLETED') {
                showToast('You have already requested or received your reward');
                return;
            }
            
            try {
                const button = document.getElementById('request-reward-btn');
                button.disabled = true;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                
                const rewardRequestDate = new Date().toISOString();
                const deliveryDate = new Date();
                deliveryDate.setDate(deliveryDate.getDate() + 3);
                
                // Update user data
                const updates = {
                    rewardStatus: 'PENDING',
                    rewardRequestDate: rewardRequestDate,
                    upi: upiId
                };
                
                await database.ref(`users/${currentUser.uid}`).update(updates);
                
                // Update local userData
                Object.assign(userData, updates);
                
                // Update UI
                updateUI();
                
                // Send Telegram notification for reward request
                sendTelegramNotification(
                    `🎁 Reward Requested\n📧 ${userData.email}\n` +
                    `💰 UPI ID: ${upiId}\n` +
                    `📅 Request Date: ${new Date(rewardRequestDate).toLocaleDateString()}\n` +
                    `📦 Delivery By: ${deliveryDate.toLocaleDateString()}\n` +
                    `⏰ ${new Date().toLocaleString()}`
                );
                
                showToast('✅ Reward request submitted! Will be sent within 3 days.');
                
                // Simulate reward completion after 3 days
                setTimeout(async () => {
                    if (userData.rewardStatus === 'PENDING') {
                        await database.ref(`users/${currentUser.uid}/rewardStatus`).set('COMPLETED');
                        userData.rewardStatus = 'COMPLETED';
                        updateUI();
                        
                        // Send Telegram notification for reward completion
                        sendTelegramNotification(
                            `💰 Reward Completed\n📧 ${userData.email}\n` +
                            `💳 UPI ID: ${upiId}\n` +
                            `✅ Status: Reward sent successfully\n` +
                            `⏰ ${new Date().toLocaleString()}`
                        );
                    }
                }, 3 * 24 * 60 * 60 * 1000); // 3 days
                
            } catch (error) {
                console.error('Error submitting reward request:', error);
                showToast('Error submitting request. Please try again.');
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Reward Request';
            }
        }

        // Copy Referral Code
        function copyReferralCode() {
            const referralCode = document.getElementById('referral-code').textContent;
            if (referralCode && referralCode !== 'CK30-LOADING') {
                navigator.clipboard.writeText(referralCode).then(() => {
                    showToast('📋 Referral code copied to clipboard!');
                }).catch(() => {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = referralCode;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showToast('📋 Referral code copied!');
                });
            }
        }

        // Share Referral
        function shareReferral() {
            const referralCode = userData?.referralCode || 'CK30-LOADING';
            const message = `Join CheckIn30 using my referral code: ${referralCode}\n\nEarn daily rewards by completing simple check-ins!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'CheckIn30 - Earn Daily Rewards',
                    text: message,
                    url: window.location.href
                });
            } else {
                copyReferralCode();
                showToast('📋 Referral link copied. Share it with friends!');
            }
        }

        // Switch Section
        function switchSection(sectionId) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.section === sectionId);
            });
            
            // Update sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.toggle('active', section.id === `${sectionId}-section`);
            });
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Show Screen
        function showScreen(screenName) {
            Object.keys(screens).forEach(key => {
                screens[key].classList.toggle('active', key === screenName);
            });
        }

        // Show Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('active');
            
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Send Telegram Notification
        async function sendTelegramNotification(message) {
            try {
                const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
                const data = {
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message,
                    parse_mode: 'HTML'
                };
                
                await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
            } catch (error) {
                console.error('Telegram notification error:', error);
            }
        }

        // Generate Unique Code
        function generateUniqueCode(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            
            for (let i = 0; i < length; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            
            return code;
        }

        // Validate Referral Code
        async function validateReferralCode(code) {
            try {
                const usersSnapshot = await database.ref('users').once('value');
                let referrerId = null;
                
                usersSnapshot.forEach((childSnapshot) => {
                    const user = childSnapshot.val();
                    if (user.referralCode === code) {
                        referrerId = childSnapshot.key;
                    }
                });
                
                return referrerId;
            } catch (error) {
                console.error('Error validating referral code:', error);
                return null;
            }
        }

        // Update Referrer Data
        async function updateReferrerData(referrerId, newUserId, newUserEmail) {
            try {
                const referrerRef = database.ref(`users/${referrerId}`);
                const referrerSnapshot = await referrerRef.once('value');
                const referrerData = referrerSnapshot.val();
                
                if (!referrerData) return;
                
                // Add referral to referrer's list
                const referralKey = database.ref(`users/${referrerId}/referralList`).push().key;
                await database.ref(`users/${referrerId}/referralList/${referralKey}`).set({
                    userId: newUserId,
                    email: newUserEmail,
                    date: new Date().toISOString(),
                    status: 'PENDING', // Will change to COMPLETED after 3 check-ins
                    pointsAwarded: false
                });
                
                // Send Telegram notification for new referral
                sendTelegramNotification(
                    `👥 New Referral\n👤 Referrer: ${referrerData.email}\n` +
                    `👥 New User: ${newUserEmail}\n` +
                    `🎯 Code Used: ${userData?.referredBy}\n` +
                    `⏰ ${new Date().toLocaleString()}`
                );
                
            } catch (error) {
                console.error('Error updating referrer data:', error);
            }
        }

        // Get Reward Status Text
        function getRewardStatusText(status) {
            switch (status) {
                case 'NOT_ELIGIBLE': return 'Not Eligible';
                case 'PENDING': return 'Processing';
                case 'COMPLETED': return 'Completed';
                default: return 'Not Eligible';
            }
        }

        // Get Error Message
        function getErrorMessage(error) {
            switch (error.code) {
                case 'auth/email-already-in-use':
                    return 'Email already registered';
                case 'auth/invalid-email':
                    return 'Invalid email address';
                case 'auth/weak-password':
                    return 'Password is too weak';
                case 'auth/wrong-password':
                    return 'Incorrect password';
                case 'auth/user-not-found':
                    return 'User not found';
                case 'auth/too-many-requests':
                    return 'Too many attempts. Try again later';
                default:
                    return 'An error occurred. Please try again';
            }
        }

        // Reset Daily Timer
        function resetDailyTimer() {
            if (confirm('Reset timer? This will restart the 2-minute wait period.')) {
                stopTimer();
                timeLeft = 120;
                updateTimerDisplay();
                updateCheckinButton(false);
                startVisitTimer();
                showToast('Timer reset successfully!');
            }
        }

        // Check Daily Check-in
        function checkDailyCheckin() {
            if (!userData || !userData.lastCheckIn) {
                return;
            }
            
            const lastCheckIn = new Date(userData.lastCheckIn);
            const today = new Date();
            
            lastCheckIn.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            
            if (lastCheckIn.getTime() === today.getTime()) {
                updateCheckinButton(true);
            }
        }
    </script>
</body>
</html>
